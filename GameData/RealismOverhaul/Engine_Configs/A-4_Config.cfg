//	==================================================
//	A-4 (V-2) Engine (Model 39)
//
//	Manufacturer: Peenem√ºnde Army Research Center
//
//	=================================================================================
//	Model 39b
//	A-4 series B, "Ofen-B", mass production V-2 engine
//
//	Dry Mass: 929.86 kg  // + 196.4kg dry propellant tanks on the V-2, not included
//	Thrust (SL): 249.1 kN
//	Thrust (Vac): 284.68 kN		[A, p.746] 64klbf vac
//	ISP: 203 SL / 242 Vac		[A, p.746]
//	Burn Time: 70
//	Chamber Pressure: 1.52 MPa	[A, p.746] 220 psi
//	Propellant: LOX / E75		[A, p.746]
//	Prop Ratio: 1.24			[A, p.746]
//	Throttle: 31% setting		[A, p.749] gas generator throttle plus fuel recirculation valve allowed 31% thrust setting in terminal mode
//	Nozzle Ratio: 3.4			[A, p.746]
//	Ignitions: 1
//	=================================================================================
//	Model 39c
//	A-4 series C, "Ofen-C", monolithic injector and storable Visol+SV propellants
//
//	Dry Mass: 888 kg		We'll say about as light as RD-101
//	Thrust (SL): ??? kN
//	Thrust (Vac): 400 kN	[3] 400 kN (vac?) chambers built
//	ISP: 201 SL / 227 Vac	calculated with RPA, same combustion efficiency as XLR43-NA-1/NAA-75-110 (closest monolithic injector to Model 39?)
//	Burn Time: 70	same as Model 39b?
//	Chamber Pressure: 2.16 MPa	same as RD-101?
//	Propellant: Salbei / Visol	[3]
//	Prop Ratio: 3.34		[4] same ratio as Wasserfall
//	Throttle: 31% setting	same as Model 39b?
//	Nozzle Ratio: 3.4		same as Model 39b?
//	Ignitions: 1
//	=================================================================================
//	Model 39c-I
//	Interkontinentalrakete, A-9/A-10 upper stage
//
//	Dry Mass: 972 kg		heavier for start equipment?
//	Thrust (SL): ??? kN
//	Thrust (Vac): 245 kN	[5] 25 tonforce
//	ISP: 195 SL / 242 Vac	calculated with RPA
//	Burn Time: 115
//	Chamber Pressure: 2.16 MPa
//	Propellant: Salbei / Visol	[3]
//	Prop Ratio: 3.34		[4] same ratio as Wasserfall
//	Throttle: N/A
//	Nozzle Ratio: 6.4	constant-ish exit area with throat pinch to lower thrust to 25 tonforce
//	Ignitions: 1
//	=================================================================================

//	Sources:

//	[1] Astronautix - A4:	http://www.astronautix.com/m/model39.html
//	[2] alternatewars - German Engines:	https://web.archive.org/web/20200229064133/http://www.alternatewars.com/BBOW/Space_Engines/German_Engines.htm
//	[3] B14643 - Aggregat A-4:	https://b14643.eu/Spacerockets/Specials/A-4/Description/Frame.htm
//	[4] http://www.b14643.de/Spacerockets/Specials/Wasserfall_postwar_rockets/index.htm
//	[5] https://www.russianspaceweb.com/a9a10.html
//	[6] https://www.cdvandt.org/Wunderwaffen-file-11110.pdf
//      [A] History of Liquid Propellant Rocket Engines, George P. Sutton, Page 746 Table 9-1

//	Used by:

//	Notes:

//	Development started 1936, originally intended to operate at 5 MPa, but was reduced to 1.5 MPa due to burnthrough issues. To combat combustion
//	instability and speed up development, 1.5-tonforce chambers from A-3 project were clustered into preburner cups, with 18 feeding into main
//	"Ofen-A" combustion chamber. First prototype delivered to Von Braun team in late 1938, Model 39a. Continued issues with burn-through and the
//	requirement for a simplifed design for mass production led to the development of the "Ofen-B" combustion chamber for the Model 39b. Additional
//	film-cooling holes at nozzle throat and a fiberglass ablative throat insert resolved burn-through issues, and thousands of other design changes
//	simplified and improved reliability, eventually leading to mass-production starting in 1944. Design changes to optimize production, reduce
//	use of strategic materials, and improve performance continued until the end of the war.

//	Intact A-4 rockets and Model 39 engines were captured by Soviet and American forces at the end of the war. Fully implementing late-war design
//	changes, access to better materials, and superior quality control meant post-war rockets built around "Ofen-B" combustion chambers generally
//	claimed superior performance. Both sides were also able to improve the basic design, with North American developing the heavily simplified
//	XLR41 as part of Navaho Phase II (although production was never pursed due to the large stock of captured A-4s available) and OKB-456
//	developing the RD-100 series with large overall improvements pushing the Model 39b design to it's limits.

//	The "Ofen-C" combustion chamber was intended for the Model 39, with a monolithic "showerhead" injector. However, development was difficult
//	and pressure to bring the A-4 into service as quickly as possible led to the "Ofen-B" chamber with clsutered pre-burners to be used instead.
//	The "Ofen-C" design was intended to operate at 4 MPa of pressure and develop 300 kN of thrust (at sea level?). Development also switched to
//	Diesel and Nitric Acid fuel to improve storability of the A-4 and eliminate the handling issues of cryogenic liquid oxygen. This was then
//	switched to Visol+Salbei (50% Isobutyl vinyl ether + 10% aniline + 40% optol (Methyl vinyl ether?), ersatz fuel produced from coal 
//	liquefaction, Salbei (MS-10, Sa-Stoff?): 90% Nitric acid + 10% Sulfuric Acid) [5, p.19]
//	The "Ofen-C" chamber made decent progress in this state, with 400 kN chamber prototypes built. "Ofen-C" also formed the basis for the 
//	Wasserfall engine, which appears to have been directly derived from subscale "Ofen-C" prototypes. Ultimately issues with a full-size "Ofen-C"
//	chamber were never resolved, including severe combustion stability issues.

//	Engine config selection:
//	Using higher performance data from post-war assembled Model 39 engines for the Model 39b. Wartime engines had poorer quality control and
//	unimplemented design changes that meant for a wide variation in performance, and documentation was much worse than post-war engines tested
//	under Navaho/Bumper/Hermes programs.

//	For Model 39c, using somewhat optimistic data. We will say 400 kN thrust level was achievable (Soviets were able to push to this thrust level
//	pretty quickly with RD-101). "Ofen-C" chamber is questionable, planar non-impinging(?) injector plate would be very susceptable to combustion
//	instability. Visol+Salbei fuel mix also not terribly efficient, and Wasserfall (using subscale "Ofen-C" design) got pretty awful performance.
//	Nonetheless, we will stick with Visol+Salbei since this is what the vast majority of "Ofen-C" work (everything post-1941?) was performed with.
//	4 MPa target chamber pressure is questionable once again, Wasserfall never exceeded 1.5 MPa of "Ofen-B" and I can't find any mention of test
//	models managing it either. We will say 2.16 MPa of RD-101?

//	For the A-9 engine, very little information exists. Work on the A-9/A-10 project was prohibited fairly early into A-4 development to focus on
//	bringing the A-4 into production, and work was only resumed in late 1944, although Von Braun continued aerodynamic work under the guise of the 
//	A-4b, a modified boost-glide A-4. Astronautix claims Ethanol/LOX power which would improve Isp, but all development work for "Ofen-C" should
//	have been focused on Visol/Salbei. Reversion to Ethanol/LOx probably would help improve performance, but it's not like A-9 would actually work
//	anyway (thermal environment was much more severe than expected). [5] claims vinyl ether/acid fuel mix. Ignition would also present a major
//	issue, V-2 relied on tank head start and black powder ignitors, with a fairly slow multi-stage start sequence, but hypergolic vinyl ether/acid
//	mix would help in that regard. It is fairly easy to improve Model 39 performance with more nozzle, and stated thrust in [5] is fairly low.
//	Claim throat pinch for expansion ratio increase?

//	==================================================
@PART[*]:HAS[#engineType[A-4]]:FOR[RealismOverhaulEngines]
{
	%title = #roA-4Title	//Model 39
	%manufacturer = #roMfrPeenemunde
	%description = #roA-4Desc

	@tags ^= :$: Germany thiel peenemunde A-4 a4 model 39 V-2 liquid pump booster ethanol lox lqdoxygen visol salbei

	%specLevel = operational

	@MODULE[ModuleEngines*]
	{
		%EngineType = LiquidFuel
	}

	!MODULE[ModuleEngineConfigs],*{}
	!MODULE[ModuleAlternator],*{}
	!RESOURCE,*{}

	@MODULE[ModuleGimbal]
	{
		%gimbalRange = 3
		%useGimbalResponseSpeed = true
		%gimbalResponseSpeed = 16
	}

	MODULE
	{
		name = ModuleEngineConfigs
		type = ModuleEngines
		configuration = Model39b
		modded = false
		origMass = 0.92986
		literalZeroIgnitions = True
		CONFIG
		{
			name = A-4
			specLevel = operational
			RODeprecated = true
			maxThrust = 284.68
			minThrust = 284.68
			maxEngineTemp = 3000
			chamberNominalTemp = 2923
			massMult = 1.0
	
			atmosphereCurve
			{
				key = 0 242
				key = 1 203
			}

			PROPELLANT
			{
				name = Ethanol75
				ratio = 0.5223
				DrawGauge = True
			}

			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.4777
			}

			PROPELLANT
			{
				name = HTP
				ignoreForIsp = True
				ratio = 0.01 // roughly 98% used at propellant burnout
			}

			ullage = True
			pressureFed = False
			ignitions = 0

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 0.200
			}


			TESTFLIGHT:NEEDS[TestLite|TestFlight]
			{
				ratedBurnTime = 70
				ignitionReliabilityStart = 0.89 // a bit worse than Hermes
				ignitionReliabilityEnd = 0.97 // a bit better than Hermes, combined with cycle leads to V-2 total reliability
				ignitionDynPresFailMultiplier = 2.0 // fairly robust
				cycleReliabilityStart = 0.75 // broadly in line with Hermes
				cycleReliabilityEnd = 0.95 // higher than achieved for Hermes/Bumper, but on track with total V-2 launches
			}
		}

		CONFIG
		{
			name = A-9
			RODeprecated = true
			maxThrust = 288.68
			minThrust = 288.68
			maxEngineTemp = 3000
			chamberNominalTemp = 2923
			specLevel = speculative
			massMult = 1.045

			atmosphereCurve
			{
				key = 0 255
				key = 1 220
			}

			PROPELLANT
			{
				name = Hydyne
				ratio = 0.4997
				DrawGauge = True
			}

			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.5003
			}

			PROPELLANT
			{
				name = HTP
				ignoreForIsp = True
				ratio = 0.01 // roughly 98% used at propellant burnout
			}

			ullage = True
			ignitions = 1

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 0.200
			}

			//no data, never flew
			TESTFLIGHT:NEEDS[TestLite|TestFlight]
			{
				ratedBurnTime = 115
				ignitionReliabilityStart = 0.87
				ignitionReliabilityEnd = 0.98
				ignitionDynPresFailMultiplier = 4.0
				cycleReliabilityStart = 0.7
				cycleReliabilityEnd = 0.94
			}
		}
		CONFIG
		{
			name = Model39b
			description = Interim mass-production version of the Model 39 for the A-4 Series B/V-2
			specLevel = operational
			maxThrust = 284.68
			minThrust = 88.25
			maxEngineTemp = 3000
			chamberNominalTemp = 2923
			massMult = 1.0
			useThrottleIspCurve = true
			//Since throttling drops chamber pressure, throttling will decrease Isp
			//At sea level
			//0.581 Isp penalty at 31% throttle
			throttleIspCurve
			{
				key = 0.000 0.581 0.0 0.0
				key = 0.310 0.581 0.0 1.0
				key = 1.000 1.000 0.1 0.0
			}
			//We do some injector throttling, so small Isp penalty in vacuum
			throttleIspCurveAtmStrength 
			{
				key = 0.0 0.05
				key = 1.0 1.0
			}
			//No continuous throttling
			throttleCurve
			{
				key = 0.500 0.31 0 0
				key = 0.501 1.00 0 0
			}
	
			atmosphereCurve
			{
				key = 0 242
				key = 1 203
			}

			PROPELLANT
			{
				name = Ethanol75
				ratio = 0.5223
				DrawGauge = True
			}

			PROPELLANT
			{
				name = LqdOxygen
				ratio = 0.4777
			}

			PROPELLANT
			{
				name = HTP
				ignoreForIsp = True
				ratio = 0.01 // roughly 98% used at propellant burnout
			}

			ullage = True
			pressureFed = False
			ignitions = 0

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 0.200
			}

			TESTFLIGHT:NEEDS[TestLite|TestFlight]
			{
				ratedBurnTime = 70
				ignitionReliabilityStart = 0.89 // a bit worse than Hermes
				ignitionReliabilityEnd = 0.97 // a bit better than Hermes, combined with cycle leads to V-2 total reliability
				ignitionDynPresFailMultiplier = 2.0 // fairly robust
				cycleReliabilityStart = 0.75 // broadly in line with Hermes
				cycleReliabilityEnd = 0.95 // higher than achieved for Hermes/Bumper, but on track with total V-2 launches
			}
		}
		CONFIG
		{
			name = Model39c
			description = Monolithic "mixing-head" injector engine. Improved thrust, decreased weight, and storable fuel mixture consisting of explosives grade acid and coal tar distillate. The combustion instability issues of this design were never resolved, although a subscale version was used as the basis for the "Wasserfall" anti-aircraft missile.
			specLevel = prototype	//lots of subscale tests, at least a few full-scale prototypes? Injector design was probably fundementally flawed but whatever
			maxThrust = 400
			minThrust = 124
			maxEngineTemp = 3000
			chamberNominalTemp = 2760
			massMult = 0.9550
			useThrottleIspCurve = true
			//Since throttling drops chamber pressure, throttling will decrease Isp
			//At sea level
			//0.721 Isp penalty at 31% throttle
			throttleIspCurve
			{
				key = 0.000 0.721 0.0 0.0
				key = 0.310 0.721 0.0 0.6
				key = 1.000 1.000 0.1 0.0
			}
			//We do some injector throttling, so small Isp penalty in vacuum
			throttleIspCurveAtmStrength 
			{
				key = 0.0 0.05
				key = 1.0 1.0
			}
			//No continuous throttling
			throttleCurve
			{
				key = 0.500 0.31 0 0
				key = 0.501 1.00 0 0
			}
	
			atmosphereCurve
			{
				key = 0 227
				key = 1 201
			}

			PROPELLANT
			{
				name = Visol
				ratio = 0.3417
				DrawGauge = True
			}

			PROPELLANT
			{
				name = Salbei
				ratio = 0.6583
			}

			PROPELLANT
			{
				name = HTP
				ignoreForIsp = True
				ratio = 0.01 // roughly 98% used at propellant burnout
			}

			ullage = True
			pressureFed = False
			ignitions = 0

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 0.200
			}

			//We'll be very generous and give this Redstone reliability
			TESTFLIGHT:NEEDS[TestLite|TestFlight]
			{
				ratedBurnTime = 70
				ignitionReliabilityStart = 0.837500
				ignitionReliabilityEnd = 0.974342
				cycleReliabilityStart = 0.837500
				cycleReliabilityEnd = 0.974342
				techTransfer = Model39b:50&Wasserfall:20
			}
		}
		CONFIG
		{
			name = Model39cI
			description = "Interkontinental" version of the Model 39c, for the A-9/A-10 upper stage. Decreased thrust and increased Isp for upper stage use, and special engine modifications to allow air-starting.
			specLevel = speculative		//If there was ever any actual engineering work done on this I haven't seen it. Most information on the A-10 and associated projects comes from post-war proposals by captured German scientists trying to sell their expertise...
			maxThrust = 245
			minThrust = 75.95
			maxEngineTemp = 3000
			chamberNominalTemp = 2760
			massMult = 1.045
			useThrottleIspCurve = true
			//Since throttling drops chamber pressure, throttling will decrease Isp
			//At sea level
			//0.462 Isp penalty at 31% throttle
			throttleIspCurve
			{
				key = 0.000 0.462 0.0 0.0
				key = 0.310 0.462 0.0 1.5
				key = 1.000 1.000 0.1 0.0
			}
			//We do some injector throttling, so small Isp penalty in vacuum
			throttleIspCurveAtmStrength 
			{
				key = 0.0 0.05
				key = 1.0 1.0
			}
			//No continuous throttling
			throttleCurve
			{
				key = 0.500 0.31 0 0
				key = 0.501 1.00 0 0
			}
	
			atmosphereCurve
			{
				key = 0 242
				key = 1 195
			}

			PROPELLANT
			{
				name = Visol
				ratio = 0.3417
				DrawGauge = True
			}

			PROPELLANT
			{
				name = Salbei
				ratio = 0.6583
			}

			PROPELLANT
			{
				name = HTP
				ignoreForIsp = True
				ratio = 0.01 // roughly 98% used at propellant burnout
			}

			ullage = True
			pressureFed = False
			ignitions = 1

			IGNITOR_RESOURCE
			{
				name = ElectricCharge
				amount = 0.200
			}

			//We'll be very generous and give this Redstone reliability
			TESTFLIGHT:NEEDS[TestLite|TestFlight]
			{
				ratedBurnTime = 115
				ignitionReliabilityStart = 0.837500
				ignitionReliabilityEnd = 0.974342
				cycleReliabilityStart = 0.837500
				cycleReliabilityEnd = 0.974342
				techTransfer = Model39c,Model39b:50&Wasserfall:20
			}
		}
	}
}
