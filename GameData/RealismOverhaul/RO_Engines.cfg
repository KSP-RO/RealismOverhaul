//  ==================================================
//  Catch any engine part modules and place them into
//  the "Engine" category.

//  Check if the part module already implements:

//  * Command modules (MechJeb)
//  * Decouplers (coupling as a primary function)
//  * Custom part categories (FilterExtensions)
//  * The "leaveCategory" parameter (leaves the part category as is)
//  ==================================================

@PART[*]:HAS[@MODULE[ModuleEngines*],!MODULE[*Decouple*],!MODULE[ModuleCommand],~leaveCategory[*]]:BEFORE[zzzRealismOverhaul]
{
    %category = Engine
}

//  ==================================================
//  Make sure that no engine part module implements a
//  TweakScale module.
//  ==================================================

@PART[*]:HAS[@MODULE[TweakScale],@MODULE[ModuleEngines*]]:FOR[zzzRealismOverhaul]
{
    !MODULE[TweakScale],*{}
}

//  ==================================================
//  Make sure that any engine tagged as a solid cannot
//  be shutdown.
//  ==================================================
@PART[*]:HAS[@MODULE[ModuleEngines*]:HAS[#EngineType[SolidBooster]]]:AFTER[RealismOverhaulEngines]
{
    @MODULE[ModuleEngines*]
    {
        %allowShutdown = False
        %throttleLocked = True
    }
}

//  ==================================================
//  Change Thrust Transform Location to stop any
//	Possible Weird Behavior with Clipped parts
//  ==================================================

@PART[*]:HAS[@MODULE[ModuleEngines*]:HAS[~thrustVectorTransformName[SmokeTransform]]]:FOR[zzzRealismOverhaul]
{
    @MODULE[ModuleEngines*]
    {
		@thrustVectorTransformName = SmokeTransform
    }
}
@PART[*]:HAS[@MODULE[ModuleEngines*]:HAS[~thrustTransformName[SmokeTransform]]]:FOR[zzzRealismOverhaul]
{
    @MODULE[ModuleEngines*]
    {
		@thrustTransformName = SmokeTransform
    }
}

//  ==================================================
//  Add surface FX to all parts that should have it.
//  ==================================================

@PART[*]:HAS[@MODULE[ModuleEngines*],!MODULE[ModuleSurfaceFX]]:FOR[zzzRealismOverhaul]
{
    MODULE
    {
        name = ModuleSurfaceFX
        thrustProviderModuleIndex = 0
        fxMax = 0.5
        maxDistance = 30
        falloff = 1.7
        thrustTransformName = SmokeTransform
    }
}

//  ==================================================
//  Change surface FX Transform
//  ==================================================

@PART[*]:HAS[@MODULE[ModuleSurfaceFX]]:AFTER[zzzRealismOverhaul]
{
    @MODULE[ModuleSurfaceFX]
    {
		%thrustTransformName = SmokeTransform
    }
}
