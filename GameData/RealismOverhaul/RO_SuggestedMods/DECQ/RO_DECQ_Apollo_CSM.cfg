//  ==================================================
//  Sources:

//  NASA - Apollo Spacecraft News Reference (H Missions):       https://www.hq.nasa.gov/alsj/CSM_News_Reference_H_Missions.pdf
//  NTRS - Apollo LES Pitch and Abort Motor Qualification:      https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19670024883.pdf
//  NTRS - Apollo Launch Escape Propulsion Subsystem:           https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19730010175.pdf
//  NASA - Apollo Launch Escape System Overview:                https://www.hq.nasa.gov/alsj/CSM15_Launch_Escape_Subsystem_pp137-146.pdf
//  NTRS - Apollo Saturn SA-7 Press Kit:                        https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19640019421.pdf
//  NASA - Apollo Earth Landing Subsystem:                      https://www.hq.nasa.gov/alsj/CSM12_Earth_Landing_Subsystem_pp93-98.pdf
//  NTRS - Apollo Recovery Operations:                          https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/20090016307.pdf
//  NASA - Apollo 15 Main Parachute Failure Report:             https://spaceflight.nasa.gov/outreach/SignificantIncidents/assets/apollo-15-mission-anomaly-report-no.-1-main-parachute-failure.pdf
//  NTRS - Apollo CM Dynamic Model Investigation:               https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19670023693.pdf
//  NTRS - Pack Density Limitations of Hybrid Parachutes:       https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/20130011328.pdf
//  NTRS - Apollo Thermal Protection Subsystem Overview:        https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19740007423.pdf
//  NASA - Apollo Command Module Overview:                      https://www.hq.nasa.gov/alsj/CSM06_Command_Module_Overview_pp39-52.pdf
//  NASA - Apollo Service Module Overview:                      https://www.hq.nasa.gov/alsj/CSM07_Service_Module_Overview_pp53-60.pdf
//  NASA - Apollo by the Numbers (LV & Spacecraft Key Facts):   https://history.nasa.gov/SP-4029/Apollo_18-13_Launch_Vehicle-Spacecraft_Key_Facts.htm
//  NTRS - Apollo Operations Handbook (Appendix C / Section 2): https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19820066936.pdf
//  NASA - Apollo CSM Reaction Control Subsystem Overview:      https://www.hq.nasa.gov/alsj/CSM16_Reaction_Control_Subsystem_pp147-158.pdf
//  NTRS - Apollo 11 Mission Report CSM RCS Performance:        https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19720017210.pdf
//  NASA - Apollo 13 Review Board Report (Appendix A):          https://history.nasa.gov/afj/ap13fj/pdf/a13-review-report-app-a-19700078804.pdf
//  NTRS - Fuel Cells for Space Science Applications:           https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/20040010319.pdf
//  NTRS - The Fuel Cell in Space:                              https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19900002488.pdf
//  NTRS - U.S. Manned and Unmanned Spacecraft EPS Overview:    https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19850005601.pdf
//  NASA - Apollo Manufacturing:                                https://www.hq.nasa.gov/alsj/CSM25_Apollo_Manufacturing_pp245-252.pdf
//  NASA - Apollo Telecommunications Overview:                  https://www.hq.nasa.gov/alsj/CSM18_Telecommunications_Subsystem_pp173-188.pdf
//  NASA - Apollo Communications Quick Reference Data:          https://www.hq.nasa.gov/alsj/LM12_Communications_ppC1-10.pdf
//  NTRS - Apollo Unified S-band System:                        https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19660018739.pdf
//  NTRS - Apollo SM-LM RCS Engine Development:                 https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19690029234.pdf
//  NTRS - Apollo CSM Propulsion Systems Overview:              https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/20090015391.pdf
//  NTRS - Remembering the Giants:                              http://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/20100027314.pdf
//  Alternate Wars - Liquid Rocket Engine Nozzles:              http://alternatewars.com/BBOW/Space/SP-8120_Excerpt.pdf
//  NASA - On the Moon With Apollo 16 (table 6):                https://history.nasa.gov/EP-95/table6.htm
//  NTRS - Apollo 15 and 16 PFS Plasma & Energetic Particles:   https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19750004799.pdf
//  NASA - Apollo CSM Subcontractors:                           https://www.hq.nasa.gov/alsj/CSM26_Apollo_Subcontractors_pp253-256.pdf

//  ==================================================
//  Removed extra parts.
//  ==================================================

!PART[APOLLO_CAP_INTERIM_PARACHUTE]:FOR[RealismOverhaul]{}

!PART[APOLLO_BOTTOM_SHIELD]:FOR[RealismOverhaul]{}

!PART[APOLLO_Antenna2]:FOR[RealismOverhaul]{}

//  ==================================================
//  Apollo LES pitch motor.

//  Dimensions: 0.66 m x 2.075 m
//  Gross Mass: 680 kg

//  The gross mass value includes the mass of the Q-ball
//  assembly (~16 kg), the canard assembly (~20 kg) and
//  the ballast mass for stabilization (~610 kg).
//  ==================================================

@PART[APOLLO_EAS_PITCH_CONTROL_MOTOR]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        %scale = 1.1289, 1.1289, 1.1289
    }

    %scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_bottom = 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 1

    @title = Apollo LES Pitch Motor
    @manufacturer = Lockheed Propulsion Co.
    @description = The pitch motor of the LES imparts a small attitude change to the Apollo Command Module during an abort. This ensures that the CM will have sufficient clearance from the launch vehicle after the LES abort motor burns out.

    @mass = 0.676
    @crashTolerance = 10
    @breakingForce = 250
    @breakingTorque = 250
    !linearStrength = NULL
    !angularStrength = NULL
    @maxTemp = 673.15
    %skinMaxTemp = 773.15
    %stageOffset = 1
    %childStageOffset = 1
    !stageAfter = NULL
    !stageBefore = NULL
    @fuelCrossFeed = False
    %CoMOffset = 0.0, 1.0, 0.0
    %bulkheadProfiles = size1

    //  One 0.62-KS-2170 rocket motor (loaded ~50 lb, dry ~41.1 lb, ASL Isp ~198 s, thrust ~2450 lbf).

    @MODULE[ModuleEngines*]
    {
        @minThrust = 10.9
        @maxThrust = 10.9
        @heatProduction = 49
        @useEngineResponseTime = False
        @engineAccelerationSpeed = 0
        %ullage = False
        %pressureFed = False
        %ignitions = 1

        @PROPELLANT[SolidFuel]
        {
            @name = HTPB
        }

        @atmosphereCurve
        {
            @key,0 = 0 208
            @key,1 = 1 198
        }
    }

    !MODULE[ModuleFuelTanks],*{}

    MODULE
    {
        name = ModuleFuelTanks
        type = HTPB
        volume = 2.3
        basemass = -1

        //  HTPB/AP propellant mass mixture ~4 kg.

        TANK
        {
            name = HTPB
            amount = 2.3
            maxAmount = 2.3
        }
    }

    !RESOURCE,*{}
}

//  ==================================================
//  Apollo LES abort motor.

//  Dimensions: 2.3 m x 8.8 m
//  Gross Mass: 2640 kg

//  The gross mass value includes the mass of the tower
//  jettison motor (~240 kg), the mounting structure for
//  the jettison motor (~40 kg) and the escape tower
//  truss (~230 kg).
//  ==================================================

@PART[APOLLO_EAS_TOWER_JETTISON_MOTOR]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        %scale = 1.1289, 1.1289, 1.1289
    }

    %scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_top = 0.0, 3.046, 0.0, 0.0, 1.0, 0.0, 1
    @node_stack_bottom = 0.0, -4.22, 0.0, 0.0, -1.0, 0.0, 2

    @title = Apollo LES Abort Motor
    @manufacturer = Lockheed Propulsion Co.
    @description = The abort motor of the LES is a powerful solid rocket motor, designed specifically to carry away the Apollo Command Module in the case of a pad or a low altitude flight abort.

    @mass = 1.218
    @crashTolerance = 12
    @breakingForce = 250
    @breakingTorque = 250
    !linearStrength = NULL
    !angularStrength = NULL
    @maxTemp = 673.15
    %skinMaxTemp = 773.15
    !stageAfter = True
    !stageBefore = True
    %stageOffset = 1
    %childStageOffset = 1
    @fuelCrossFeed = False
    %CoMOffset = 0.0, 1.0, 0.0
    %bulkheadProfiles = size1, size2

    //  One 3.23-KS-139400 rocket motor (loaded ~4700 lb, dry ~1570 lb, ASL Isp ~164 s, thrust ~156000 lbf).

    @MODULE[ModuleEngines]
    {
        @minThrust = 693.7
        @maxThrust = 693.7
        @heatProduction = 84
        @useEngineResponseTime = False
        @engineAccelerationSpeed = 0
        %ullage = False
        %pressureFed = False
        %ignitions = 1

        @PROPELLANT[SolidFuel]
        {
            @name = HTPB
        }

        //  Transforms 0 and 1 are for the jettison motor.
        //  Transforms 2 through 5 are for the abort motor.

        //  The transforms 2 and 5 represent the yaw nozzles. The +Y nozzle in reality
        //  had a smaller exit throat diameter than the -Y nozzle, so that the thrust
        //  vector would be offset from vertical. Combining the offset thrust vector with
        //  the offset center of mass of the LES (plus the Apollo CM) leads to a small
        //  thrust torque, enough to fulfill both the required horizontal and vertical
        //  separation distances from the launch vehicle.

        transformMultipliers
        {
            trf0 = 0.08998
            trf1 = 0.08998
            trf2 = 0.23201
            trf3 = 0.20501
            trf4 = 0.20501
            trf5 = 0.16801
        }

        @atmosphereCurve
        {
            @key,0 = 0 172
            @key,1 = 1 164
        }
    }

    !MODULE[ModuleFuelTanks],*{}

    MODULE
    {
        name = ModuleFuelTanks
        type = HTPB
        volume = 803.4
        basemass = -1

        //  HTPB/AP propellant mixture mass ~1422 kg.

        TANK
        {
            name = HTPB
            amount = 803.4
            maxAmount = 803.4
        }
    }

    !RESOURCE,*{}
}

//  ==================================================
//  Apollo LES Booster Protection Cover (BPC).

//  Dimensions: 3.96 m x 2.9 m
//  Inert Mass: 318 kg
//  ==================================================

@PART[APOLLO_EAS_CAP]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        %scale = 1.0, 1.0, 1.0
    }

    %scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_top = 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 2
    @node_stack_bottom = 0.0, 0.42, 0.0, 0.0, -1.0, 0.0, 1

    @category = Coupling
    @title = Apollo LES Booster Protection Cover (BPC)
    @manufacturer = Lockheed
    @description = The booster protection cover protects the Apollo Command Module from the exhaust of the LES abort motor. Also doubles as a thermal protection system during the early phases of a launch.

    @mass = 0.318
    @crashTolerance = 16
    @breakingForce = 250
    @breakingTorque = 250
    !linearStrength = NULL
    !angularStrength = NULL
    @maxTemp = 673.15
    %skinMaxTemp = 773.15
    %stageOffset = 1
    %childStageOffset = 1
    !stageAfter = NULL
    !stageBefore = NULL
    @fuelCrossFeed = False
    %bulkheadProfiles = size1, size2

    @MODULE[ModuleDecouple]
    {
        @ejectionForce = 0
    }
}

//  ==================================================
//  Apollo Command Module (CM) forward heat shield and
//  docking probe.

//  Dimensions: 2 m x 1.15 m
//  Inert Mass: 140 kg

//  The inert mass value includes the mass of both the
//  forward heat shield (104 kg) and the mass of the
//  probe docking module (36 kg).
//  ==================================================

@PART[DOCKinPORT]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_top = 0.0, 0.428, 0.0, 0.0, 1.0, 0.0, 1
    @node_stack_bottom = 0.0, -0.329, 0.0, 0.0, -1.0, 0.0, 1

    @title = Apollo Forward Heat Shield
    @manufacturer = North American Aviation
    @description = The forward heat shield and docking probe for the Apollo Command Module. After soft docking the probe is retracted, allowing the two spacecraft to dock hard. It can also be extended after undocking to push them apart.

    @mass = 0.14
    @crashTolerance = 10
    %breakingForce = 250
    %breakingTorque = 250
    @maxTemp = 973.15
    %skinMaxTemp = 1073.15
    !stageAfter = NULL
    !stageBefore = NULL
    @fuelCrossFeed = False
    @stageOffset = 1
    %childStageOffset = 1
    @stagingIcon = DECOUPLER_HOR
    @bulkheadProfiles = size1

    @MODULE[ModuleDecouple]
    {
        @ejectionForce = 15
    }

    @MODULE[ModuleAnimateGeneric]
    {
        @startEventGUIName = Extend Docking Probe
        @endEventGUIName = Retract Docking Probe
        @actionGUIName = Toggle Docking Probe
    }

    @MODULE[ModuleDockingNode]
    {
        @nodeType = Apollo
        %gendered = True
        %genderFemale = False
        %acquireForce = 0.5
        %acquireMinFwdDot = 0.8
        %acquireminRollDot = -3.40282347E+38
        %acquireRange = 0.25
        %acquireTorque = 0.5
        %captureMaxRvel = 0.1
        %captureMinFwdDot = 0.998
        %captureMinRollDot = -3.40282347E+38
        %captureRange = 0.05
        %minDistanceToReEngage = 0.25
        %undockEjectionForce = 0.1
    }

    !MODULE[ModuleConnectedLivingSpace],*{}

    MODULE:NEEDS[ConnectedLivingSpace]
    {
        name = ModuleConnectedLivingSpace
        passable = True
    }
}

//  ==================================================
//  Apollo drogue parachute pack.

//  Dimensions: 0.87 m x 0.4 m
//  Inert Mass: 25 kg

//  The inert mass value has been calculated based on
//  the packing density of the main parachute pack
//  (approximately 684 kg/m3).
//  ==================================================

@PART[INTERIM_PARACHUTE]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
        %rotation = 0.0, 180.0, 0.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_top = 0.0, 0.0, -0.9, 0.0, -1.0, 0.0, 1

    @title = Apollo Drogue Parachute Pack
    @manufacturer = Northrop Corp.
    @description = The drogue parachute pack is meant to slow down the Apollo spacecraft at a high altitude in preparation for the deployment of the main parachute pack.

    @mass = 0.025
    @crashTolerance = 8
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 673.15
    %skinMaxTemp = 773.15
    @stageOffset = 1
    %childStageOffset = 1
    %stagingIcon = PARACHUTES
    %fuelCrossFeed = True
    @bodyLiftMultiplier = 0
    %bulkheadProfiles = size1

    //  Two drogue parachutes (2.6 m unreefed, 5 m reefed each).

    @MODULE[ModuleParachute]
    {
        @stowedDrag = 0
        @semiDeployedDrag = 2
        @fullyDeployedDrag = 3
        @minAirPressureToOpen = 0.02
        @clampMinAirPressure = 0.02
        @deployAltitude = 7625
        @semiDeploymentSpeed = 1.6
        @deploymentSpeed = 10.0
        @autoCutSpeed = 0.5
        @chuteMaxTemp = 473.15
    }

    @MODULE[ModuleDragModifier]:HAS[#dragCubeName[SEMIDEPLOYED]]
    {
        @dragModifier = 0.78125
    }

    @MODULE[ModuleDragModifier]:HAS[#dragCubeName[DEPLOYED]]
    {
        @dragModifier = 1.25
    }
}

//  ==================================================
//  Apollo drogue parachute pack.

//  RealChute compatibility.
//  ==================================================

@PART[INTERIM_PARACHUTE]:FOR[RealismOverhaulRC]:NEEDS[RealChute]
{
    !sound_parachute* = NULL

    @category = none

    !MODULE[ModuleParachute],*{}

    !MODULE[RealChute*],*{}

    //  Pre-deployment diameter:  2.6 m
    //  Pre-deployment altitude: 7625 m
    //  Deployment diameter:      5.0 m
    //  Deployment altitude:     7315 m

    MODULE
    {
        name = RealChuteModule
        caseMass = 0.0206
        timer = 0
        mustGoDown = True
        spareChutes = 0
        cutSpeed = 0.5
        secondaryChute = False

        PARACHUTE
        {
            parachuteName = CANOPY
            capName = Parashute
            preDeploymentAnimation = SEMI
            deploymentAnimation = FULL
            material = Nylon
            minIsPressure = False
            minPressure = 0.01
            preDeployedDiameter = 5.2
            preDeploymentSpeed = 1.6
            minDeployment = 7625
            deployedDiameter = 10.0
            deploymentSpeed = 10.0
            deploymentAlt = 7315
            cutAlt = 3350
        }
    }

    EFFECTS
    {
        rcpredeploy
        {
            AUDIO
            {
                channel = Ship
                clip = sound_parachute_open
                volume = 1
            }
        }

        rcdeploy
        {
            AUDIO
            {
                channel = Ship
                clip = sound_parachute_single
                volume = 1
            }
        }

        rccut
        {
            AUDIO
            {
                channel = Ship
                clip = RealChute/Sounds/sound_parachute_cut
                volume = 1
            }
        }

        rcrepack
        {
            AUDIO
            {
                channel = Ship
                clip = RealChute/Sounds/sound_parachute_repack
                volume = 1
            }
        }
    }
}

//  ==================================================
//  Apollo main parachute pack.

//  Dimensions: 1.56 m x 0.55 m
//  Inert Mass: 175 kg
//  ==================================================

@PART[APOLLO_chute]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_top = 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 2

    @title = Apollo Main Parachute Pack
    @manufacturer = Northrop Corp.
    @description = The main parachute pack of the Apollo Command Module.

    @mass = 0.175
    @crashTolerance = 8
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 673.15
    %skinMaxTemp = 773.15
    @stageOffset = 1
    %childStageOffset = 1
    %stagingIcon = PARACHUTES
    %fuelCrossFeed = True
    %bulkheadProfiles = size2

    //  Three parachutes (unreefed 12.7 m, reefed 25.4 m, 57.6 kg each).

    @MODULE[ModuleParachute]
    {
        @stowedDrag = 0
        @semiDeployedDrag = 2
        @fullyDeployedDrag = 3
        @minAirPressureToOpen = 0.02
        @clampMinAirPressure = 0.02
        @deployAltitude = 3350
        @deploymentSpeed = 2.5
        @semiDeploymentSpeed = 5.0
        @autoCutSpeed = 0.5
        @chuteMaxTemp = 473.15
    }

    @MODULE[ModuleDragModifier]:HAS[#dragCubeName[SEMIDEPLOYED]]
    {
        @dragModifier = 0.9375
    }

    @MODULE[ModuleDragModifier]:HAS[#dragCubeName[DEPLOYED]]
    {
        @dragModifier = 3.125
    }
}

//  ==================================================
//  Apollo main parachute pack.

//  RealChute compatibility.
//  ==================================================

@PART[APOLLO_chute]:FOR[RealismOverhaulRC]:NEEDS[RealChute]
{
    !sound_parachute* = NULL

    @category = none

    !MODULE[ModuleParachute],*{}

    !MODULE[RealChute*],*{}

    //  Pre-deployment diameter: 12.7 m
    //  Pre-deployment altitude: 3660 m
    //  Deployment diameter:     25.4 m
    //  Deployment altitude:     3350 m

    //  Using half diameter parachutes (38.1 m combined instead of 76.2 m).

    MODULE
    {
        name = RealChuteModule
        caseMass = 0.1106
        mustGoDown = True
        spareChutes = 0
        cutSpeed = 0.5

        PARACHUTE
        {
            parachuteName = CANOPY
            capName = Parashute
            preDeploymentAnimation = SEMI
            deploymentAnimation = FULL
            material = Nylon
            minIsPressure = False
            minPressure = 0.01
            preDeployedDiameter = 19.1
            preDeploymentSpeed = 6.0
            minDeployment = 3660
            deployedDiameter = 38.1
            deploymentSpeed = 10.0
            deploymentAlt = 3350
            cutAlt = 0
        }
    }

    EFFECTS
    {
        rcpredeploy
        {
            AUDIO
            {
                channel = Ship
                clip = sound_parachute_open
                volume = 1
            }
        }

        rcdeploy
        {
            AUDIO
            {
                channel = Ship
                clip = sound_parachute_single
                volume = 1
            }
        }

        rccut
        {
            AUDIO
            {
                channel = Ship
                clip = RealChute/Sounds/sound_parachute_cut
                volume = 1
            }
        }

        rcrepack
        {
            AUDIO
            {
                channel = Ship
                clip = RealChute/Sounds/sound_parachute_repack
                volume = 1
            }
        }
    }
}

//  ==================================================
//  Apollo Command Module (CM).

//  Dimensions: 3.91 m x 2.76 m
//  Gross Mass: 5355 kg

//  The gross mass value includes the mass of the heat
//  shield (~1360 kg).

//  Center of mass is offset in order to achieve the
//  proper attitude characteristics for a boost-glide
//  (skip reentry) trajectory.
//  ==================================================

@PART[APOLLO_CM]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    //  Drogue parachute pack deployment mortar model.

    MODEL
    {
        model = ATS/SATURN_V/DECQ_PROJECT_APOLLO/CAP_INTERIM_PARACHUTE
        scale = 1.0, 1.0, 1.0
        position = 0.0, 1.15, 0.33
        rotation = 0.0, 180.0, 0.0
    }

    //  Heat shield model.

    MODEL
    {
        model = ATS/SATURN_V/DECQ_PROJECT_APOLLO/APOLLO_BOTTOM_SHIELD
        scale = 1.0, 1.0, 1.0
        position = 0.0, -0.713, 0.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_top = 0.0, 0.87, 0.0, 0.0, 1.0, 0.0, 1
    @node_stack_PARA = 0.0, 0.87, 0.0, 0.0, -1.0, 0.0, 1
    @node_stack_PARA2 = 0.0, 1.165, -0.58, 0.0, 1.0, 0.0, 1
    @node_stack_bottom = 0.0, -1.24, 0.0, 0.0, -1.0, 0.0, 2

    @title = Apollo Command Module (CM)
    @manufacturer = North American Aviation
    @description = The Command Module of the Apollo spacecraft.

    @mass = 4.385
    @crashTolerance = 8
    %breakingForce = 250
    %breakingTorque = 250
    @maxTemp = 973.15
    @skinMaxTemp = 3573.15
    %emissiveConstant = 0.6
    %thermalMassModifier = 1.0
    %skinMassPerArea = 2.0
    %buoyancy = 1.1
    @fuelCrossFeed = True
    @vesselType = Ship
    @CrewCapacity = 3
    !stageAfter = False
    !stageBefore = False
    @CoMOffset = 0.0, -0.25, 0.17
    %bulkheadProfiles = size1, size2

    @MODULE[ModuleCommand]
    {
        @minimumCrew = 0

        RESOURCE
        {
            name = ElectricCharge
            rate = 1.52
        }
    }

    @MODULE[ModuleSAS]
    {
        %SASServiceLevel = 3

        !RESOURCE,*{}
    }

    @MODULE[ModuleScienceContainer]
    {
        @storageRange = 2.0
    }

    !MODULE[ModuleReactionWheel],*{}

    @MODULE[ModuleAnimateGeneric]:HAS[#animationName[ALH1]]
    {
        @startEventGUIName = Turn On Window Lights
        @endEventGUIName = Turn Off Window Lights
        %actionGUIName = Toggle Window Lights
    }

    //  SE-8 thrusters for attitude control during reentry (thrust 93 lbf, VAC Isp 274 s, O/F ratio 2.0).

    @MODULE[ModuleRCS*]
    {
        @thrusterPower = 0.411
        !rcsEnabled = True
        !resourceName = NULL
        !resourceFlowMode = NULL

        PROPELLANT
        {
            name = MMH
            ratio = 0.4557
        }

        PROPELLANT
        {
            name = NTO
            ratio = 0.5443
        }

        PROPELLANT
        {
            name = Helium
            ratio = 10.0
            ignoreForIsp = True
        }

        @atmosphereCurve
        {
            @key,0 = 0 274
            @key,1 = 1 137
        }
    }

    !MODULE[ModuleDataTransmitter],*{}

    MODULE
    {
        name = ModuleDataTransmitter
        antennaType = DIRECT
        antennaPower = 64
        antennaCombinable = True
        antennaCombinableExponent = 2.0
        packetInterval = 1.0
        packetSize = 2.048
        requiredResource = ElectricCharge
        packetResourceCost = 0.04
        DeployFxModules = 0
    }

    !MODULE[ModuleAblator],*{}

    MODULE
    {
        name = ModuleAblator
        ablativeResource = Ablator
        outputResource = CharredAblator
        outputMult = 0.75
        useChar = True
        charModuleName = HeatShieldCharAnim
        charMin = 0
        charMax = 1
        lossExp = -40000
        lossConst = 15000
        pyrolysisLossFactor = 40000
        ablationTempThresh = 500
        reentryConductivity = 0.01
    }

    @MODULE[ModuleAblator]:NEEDS[DeadlyReentry]
    {
        @name = ModuleHeatShield
        %depletedMaxTemp = 1200
    }

    MODULE
    {
        name = ModuleColorChanger
        moduleID = HeatShieldCharAnim
        shaderProperty = _BurnColor
        useRate = False
        toggleInEditor = False
        toggleInFlight = False

        redCurve
        {
            key = 0 0
            key = 1 1
        }

        greenCurve
        {
            key = 0 0
            key = 1 1
        }

        blueCurve
        {
            key = 0 0
            key = 1 1
        }

        alphaCurve
        {
            key = 0 0.8
        }
    }

    !MODULE[ModuleConnectedLivingSpace],*{}

    MODULE:NEEDS[ConnectedLivingSpace]
    {
        name = ModuleConnectedLivingSpace
        passable = True
        impassablenodes = PARA, PARA2, bottom
    }

    !MODULE[ModuleFuelTanks],*{}

    MODULE
    {
        name = ModuleFuelTanks
        type = ServiceModule
        volume = 120
        basemass = -1

        //  Three batteries ~3.36 kWn (28 V @ 40 Ah each).
        //  Support the Command Module for the duration of it's free
        //  flight before and after reentry (approximately 2 hours).

        TANK
        {
            name = ElectricCharge
            amount = 12096
            maxAmount = 12096
        }

        //  ACS fuel mass ~40 kg (two tanks).

        TANK
        {
            name = MMH
            amount = 46
            maxAmount = 46
        }

        //  ACS oxidizer mass ~81 kg (two tanks).

        TANK
        {
            name = NTO
            amount = 55
            maxAmount = 55
        }

        //  ACS pressurization gas mass ~0.18 kg (two tanks).

        TANK
        {
            name = Helium
            amount = 1010
            maxAmount = 1010
        }
    }

    !RESOURCE,*{}

    //  Avco 5026-39G ablative material mass ~848 kg.

    RESOURCE
    {
        name = Ablator
        amount = 848
        maxAmount = 848
    }

    RESOURCE
    {
        name = CharredAblator
        amount = 0
        maxAmount = 636
        isTweakable = False
    }
}

//  ==================================================
//  Apollo Command Module (CM).

//  Internal space configuration.
//  ==================================================

@INTERNAL[APOLLO_cockpit*]:FOR[RealismOverhaul]
{
    %scaleAll = 1.64, 1.64, 1.64

    @MODULE[InternalSeat],*
    {
        %kerbalScale = 1.64, 1.64, 1.64
        %kerbalOffset = 0.0, 0.0, 0.0
        %kerbalEyeOffset = 0.0, 0.0, 0.0
    }
}

//  ==================================================
//  Apollo Command Module (CM).

//  Remote Tech compatibility
//  ==================================================

@PART[APOLLO_CM]:FOR[RealismOverhaulRT]:NEEDS[RemoteTech]
{
    @description ^= :$: Integrated telecommunications system for near Earth communications. Maximum effective range approximately 40 Mm, power consumption 20 Watts, data rate 512 kbit/s.

    !MODULE[ModuleDataTransmitter],*{}

    !MODULE[ModuleRTAntenna*],*{}

    !MODULE[ModuleSPU*],*{}

    @MODULE[ModuleCommand]
    {
        @RESOURCE[ElectricCharge]
        {
            @rate -= 0.02
        }
    }

    MODULE
    {
        name = ModuleSPU
        IsRTCommandStation = False
        RTCommandMinCrew = 0
    }

    //  Four omnidirectional slot S-band antennas for Earth interface communications.
    //  Two redundant TWTAs for driving the CM antennae (same as the SM HGA).

    MODULE
    {
        name = ModuleRTAntenna
        ActionMode0Name = Deactivate Internal Antenna
        ActionMode1Name = Activate Internal Antenna
        IsRTActive = False
        Mode0OmniRange = 0
        Mode1OmniRange = 400000
        EnergyCost = 0.02
        DeployFxModules = 0

        TRANSMITTER
        {
            PacketInterval = 1.0
            PacketSize = 0.512
            PacketResourceCost = 0.02
        }
    }
}

//  ==================================================
//  Apollo Command Module (CM).

//  TAC Life Support compatibility
//  ==================================================

@PART[APOLLO_CM]:FOR[RealismOverhaulTACLS]:NEEDS[TacLifeSupport]
{
    @description ^= :$: Supports a crew of three for up to 14 days of active operations.

    @mass -= 0.15

    @MODULE[ModuleFuelTanks]
    {
        @volume += 380

        TANK
        {
            name = Food
            amount = 245.7
            maxAmount = 245.7
        }

        //  One water storage tank with a capacity of ~16 kg.

        TANK
        {
            name = Water
            amount = 16
            maxAmount = 16
        }

        TANK
        {
            name = Oxygen
            amount = 1755.5
            maxAmount = 1755.5
        }

        TANK
        {
            name = LithiumHydroxide
            amount = 43.2
            maxAmount = 43.2
        }

        //  One waste water tank with a capacity of ~25 kg.

        TANK
        {
            name = WasteWater
            amount = 0
            maxAmount = 25
        }

        TANK
        {
            name = Waste
            amount = 0
            maxAmount = 22.4
        }

        TANK
        {
            name = CarbonDioxide
            amount = 0
            maxAmount = 1534.5
        }
    }

    !MODULE[TacGenericConverter],*{}

    MODULE
    {
        name = TacGenericConverter
        converterName = CO2 LiOH Scrubber
        tag = Life Support
        StartActionName = Start CO2 Scrubber
        StopActionName = Stop CO2 Scrubber
        conversionRate = 3.0
        GeneratesHeat = False
        UseSpecialistBonus = False

        INPUT_RESOURCE
        {
            ResourceName = CarbonDioxide
            Ratio = 0.006216
            FlowMode = STAGE_PRIORITY_FLOW
        }

        INPUT_RESOURCE
        {
            ResourceName = ElectricCharge
            Ratio = 0.1
        }

        INPUT_RESOURCE
        {
            ResourceName = LithiumHydroxide
            Ratio = 0.00001189
            FlowMode = STAGE_PRIORITY_FLOW
        }

        OUTPUT_RESOURCE
        {
            ResourceName = Waste
            Ratio = 0.00003932
            DumpExcess = False
            FlowMode = STAGE_PRIORITY_FLOW
        }
    }
}

//  ==================================================
//  Apollo Command Module (CM).

//  Part cleanup.
//  ==================================================

@PART[APOLLO_CM]:FOR[zzzRealismOverhaul]
{
    //  Secondary pass to ensure that TACLS will not
    //  add extra life support resources by it's own.

    !RESOURCE:HAS[~name[Ablator],~name[CharredAblator]],*{}
}

//  ==================================================
//  Apollo Service Module (SM).

//  Dimensions: 3.91 m x 5 m
//  Gross Mass: 23685 kg
//  ==================================================

@PART[APOLLO_SM]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_top = 0.0, 0.86, 0.0, 0.0, 1.0, 0.0, 3
    @node_stack_SIM = 0.816, -2.4, -1.445, 0.0, 1.0, 0.0, 0
    @node_stack_Antenna = -1.105, -3.43, 1.455, 0.0, 1.0, 0.0, 1
    @node_stack_Antenna2 = 1.12, -3.245, -1.41, 0.0, 1.0, 0.0, 1
    @node_stack_Engine = 0.0, -3.51, 0.0, 0.0, -1.0, 0.0, 3
    @node_stack_bottom = 0.0, -3.245, 0.0, 0.0, -1.0, 0.0, 2, 1, 3

    @category = FuelTank
    @title = Apollo Service Module (SM)
    @manufacturer = North American Aviation
    @description = The Apollo Service Module contains the main propellant tanks, the fuel cells, life support and everything else that it is needed for a flight to the Moon.

    @mass = 3.73
    @crashTolerance = 10
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 673.15
    %skinMaxTemp = 773.15
    !stageAfter = NULL
    !stageBefore = NULL
    !linearStrength = NULL
    !angularStrength = NULL
    %stageOffset = 1
    %childStageOffset = 1
    %stagingIcon = DECOUPLER_HOR
    %fuelCrossFeed = True
    @CoMOffset = 0.0, 0.0, 0.0
    %bulkheadProfiles = size0, size1, size3

    @MODULE[ModuleDecouple]
    {
        @ejectionForce = 10
        %menuName = Separate CSM
    }

    @MODULE[ModuleAnimateGeneric]:HAS[#animationName[USS]]
    {
        @startEventGUIName = Unlock CSM Umbilical
        @endEventGUIName = Lock CSM Umbilical
        %actionGUIName = Toggle CSM Umbilical
    }

    @MODULE[ModuleAnimateGeneric]:HAS[#animationName[openCap]]
    {
        @startEventGUIName = Open Subsatellite Cover
        @endEventGUIName = Close Subsatellite Cover
        %actionGUIName = Toggle Subsatellite Cover
    }

    @MODULE[ModuleAnimateGeneric]:HAS[#animationName[LHT]]
    {
        @startEventGUIName = Open Light
        @endEventGUIName = Close Light
        %actionGUIName = Toggle Light
    }

    @MODULE[ModuleAnimateGeneric]:HAS[#animationName[LH_2]]
    {
        %actionGUIName = Toggle Docking Spotlight
    }

    @MODULE[ModuleAnimateGeneric]:HAS[#animationName[ApolloDockLight]]
    {
        %actionGUIName = Toggle Docking Light
    }

    !MODULE[ModuleResourceConverter],*{}

    //  Three alkaline fuel cell modules (rated 28 V @ 1500 W max continuous output power each).
    //  Using 1400 W output power as the nominal max value here (range 400 W to 1420 W each),
    //  since the fuel cells can automatically throttle down if the batteries are charged.

    MODULE
    {
        name = ModuleResourceConverter
        ConverterName = Fuel Cell #1
        AlwaysActive = False
        StartActionName = Start Fuel Cell #1
        StopActionName = Stop Fuel Cell #1
        FillAmount = 1.0
        AutoShutdown = False
        GeneratesHeat = False
        UseSpecialistBonus = False

        INPUT_RESOURCE
        {
            ResourceName = LqdHydrogen
            Ratio = 0.0002285212
            FlowMode = STAGE_PRIORITY_FLOW
        }

        INPUT_RESOURCE
        {
            ResourceName = LqdOxygen
            Ratio = 0.0001126361
            FlowMode = STAGE_PRIORITY_FLOW
        }

        OUTPUT_RESOURCE
        {
            ResourceName = ElectricCharge
            Ratio = 1.4
            DumpExcess = False
        }

        OUTPUT_RESOURCE
        {
            ResourceName = Water
            Ratio = 0.0001447086
            DumpExcess = True
            FlowMode = STAGE_PRIORITY_FLOW
        }
    }

    MODULE
    {
        name = ModuleResourceConverter
        ConverterName = Fuel Cell #2
        AlwaysActive = False
        StartActionName = Start Fuel Cell #2
        StopActionName = Stop Fuel Cell #2
        FillAmount = 1.0
        AutoShutdown = False
        GeneratesHeat = False
        UseSpecialistBonus = False

        INPUT_RESOURCE
        {
            ResourceName = LqdHydrogen
            Ratio = 0.0002285212
            FlowMode = STAGE_PRIORITY_FLOW
        }

        INPUT_RESOURCE
        {
            ResourceName = LqdOxygen
            Ratio = 0.0001126361
            FlowMode = STAGE_PRIORITY_FLOW
        }

        OUTPUT_RESOURCE
        {
            ResourceName = ElectricCharge
            Ratio = 1.4
            DumpExcess = False
        }

        OUTPUT_RESOURCE
        {
            ResourceName = Water
            Ratio = 0.0001447086
            DumpExcess = True
            FlowMode = STAGE_PRIORITY_FLOW
        }
    }

    MODULE
    {
        name = ModuleResourceConverter
        ConverterName = Fuel Cell #3
        AlwaysActive = False
        StartActionName = Start Fuel Cell #3
        StopActionName = Stop Fuel Cell #3
        FillAmount = 1.0
        AutoShutdown = False
        GeneratesHeat = False
        UseSpecialistBonus = False

        INPUT_RESOURCE
        {
            ResourceName = LqdHydrogen
            Ratio = 0.0002285212
            FlowMode = STAGE_PRIORITY_FLOW
        }

        INPUT_RESOURCE
        {
            ResourceName = LqdOxygen
            Ratio = 0.0001126361
            FlowMode = STAGE_PRIORITY_FLOW
        }

        OUTPUT_RESOURCE
        {
            ResourceName = ElectricCharge
            Ratio = 1.4
            DumpExcess = False
        }

        OUTPUT_RESOURCE
        {
            ResourceName = Water
            Ratio = 0.0001447086
            DumpExcess = True
            FlowMode = STAGE_PRIORITY_FLOW
        }
    }

    !MODULE[ModuleFuelTanks],*{}

    MODULE
    {
        name = ModuleFuelTanks
        type = ServiceModule
        volume = 17120
        basemass = -1

        //  One battery ~12 kWn (28 V @ 400 Ah, only for J missions).

        TANK
        {
            name = ElectricCharge
            amount = 0
            maxAmount = 43200
        }

        //  Fuel cells fuel mass ~26 kg (two ~13 kg dewar tanks).

        TANK
        {
            name = LqdHydrogen
            amount = 367
            maxAmount = 367
            isDewar = True
        }

        //  Fuel cells oxidizer mass ~290 kg (two ~145 kg dewar tanks).

        TANK
        {
            name = LqdOxygen
            amount = 254
            maxAmount = 254
            isDewar = True
        }

        //  Water mass ~100 kg (two ~50 kg tanks).
        //  Also stores the water generated by the fuel cells.

        TANK
        {
            name = Water
            amount = 100
            maxAmount = 100
        }

        //  Apollo SPS and ACS fuel mass ~7385 kg (~7148 kg for the SPS and ~238 kg for the ACS).

        TANK
        {
            name = Aerozine50
            amount = 8206
            maxAmount = 8206
        }

        //  Apollo SPS and ACS oxidizer mass ~11816 kg (~11436 kg for the SPS and ~380 kg for the ACS).

        TANK
        {
            name = NTO
            amount = 8149
            maxAmount = 8149
        }
    }

    !RESOURCE,*{}
}

//  ==================================================
//  Apollo Service Module (SM).

//  TAC Life Support compatibility.
//  ==================================================

@PART[APOLLO_SM]:FOR[RealismOverhaulTACLS]:NEEDS[TacLifeSupport]
{
    !MODULE[TacGenericConverter],*{}

    //  LOX to GOX converter. Converts the liquid oxygen into gas oxygen for
    //  the life support system with a maximum rated output of ~1.4 lb/h.

    MODULE
    {
        name = TacGenericConverter
        converterName = LOX to GOX Converter
        tag = Life Support
        StartActionName = Start LOX to GOX Converter
        StopActionName = Stop LOX to GOX Converter
        conversionRate = 1.0
        GeneratesHeat = False
        UseSpecialistBonus = False

        INPUT_RESOURCE
        {
            ResourceName = LqdOxygen
            Ratio = 0.0000154599
            FlowMode = STAGE_PRIORITY_FLOW
        }

        INPUT_RESOURCE
        {
            ResourceName = ElectricCharge
            Ratio = 0.05
        }

        OUTPUT_RESOURCE
        {
            ResourceName = Oxygen
            Ratio = 0.0125104279
            DumpExcess = False
            FlowMode = STAGE_PRIORITY_FLOW
        }
    }
}

//  ==================================================
//  Apollo Service Module (SM).

//  Allow the RCS to work after the
//	ModuleToggleCrossfeed is added by RO
//  ==================================================

@PART[APOLLO_SM]:AFTER[zzzRealismOverhaul]
{
	@MODULE[ModuleToggleCrossfeed]
	{
		@crossfeedStatus = True
	}
}

//  ==================================================
//  Apollo Service Module RCS block.

//  Dimensions: 0.8 m x 1.1 m
//  Inert Mass: 14 kg

//  The inert mass value includes the mass of the RCS
//  quad housing (~5 kg).
//  ==================================================

@PART[APOLLO_RCS]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        %scale = 1.0, 1.0, 1.0
    }

    %scale = 1.0
    @rescaleFactor = 1.0

    @title = Apollo Service Module RCS Block
    @manufacturer = Marquardt Corp.
    @description = The attitude control thruster blocks of the Apollo Service Module (SM). Four of these allow full three-axis attitude control and translation of the Apollo CSM.

    @mass = 0.014
    @crashTolerance = 10
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 673.15
    %skinMaxTemp = 773.15
    !stageAfter = NULL
    !stageBefore = NULL
    !linearStrength = NULL
    !angularStrength = NULL
    @fuelCrossFeed = True
    %bulkheadProfiles = srf

    //  Four R-4D thrusters for attitude control (mass 5 lb, thrust 100 lbf, VAC Isp 280 s, O/F ratio 2.0 each).

    @MODULE[ModuleRCS*]
    {
        @thrusterPower = 0.445
        !resourceName = NULL
        !resourceFlowMode = NULL
        !enableX = NULL
        !enableY = NULL
        !enableZ = NULL

        PROPELLANT
        {
            name = Aerozine50
            ratio = 0.5575
        }

        PROPELLANT
        {
            name = NTO
            ratio = 0.4425
        }

        @atmosphereCurve
        {
            @key,0 = 0 278
            @key,1 = 1 168
        }
    }
}

//  ==================================================
//  Apollo High Gain Antenna (HGA).

//  Dimensions: 1.65 m x 1.62 m
//  Inert Mass: 43 kg
//  ==================================================

@PART[APOLLO_High_Gain_S_band_Antenna]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_top = 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 1

    @title = Apollo High Gain Antenna (HGA)
    @manufacturer = Dalmo Victor Co.
    @description = The primary high gain antenna of the Apollo spacecraft, used for deep space communications.

    @mass = 0.043
    @crashTolerance = 10
    %breakingForce = 250
    %breakingTorque = 250
    @maxTemp = 673.15
    %skinMaxTemp = 773.15
    !stageAfter = NULL
    !stageBefore = NULL
    @fuelCrossFeed = False
    %bulkheadProfiles = size1

    @MODULE[ModuleDeployableAntenna]
    {
        %isBreakable = False
        %extendActionName = Extend HGA
        %retractActionName = Retract HGA
        %extendpanelsActionName = Toggle HGA
    }

    @MODULE[ModuleDataTransmitter]
    {
        @antennaType = RELAY
        @antennaPower = 14400
        %antennaCombinable = True
        %antennaCombinableExponent = 2.0
        @packetInterval = 1.0
        @packetSize = 2.0
        @packetResourceCost = 0.04
    }
}

//  ==================================================
//  Apollo High Gain Antenna (HGA).

//  Remote Tech compatibility.
//  ==================================================

@PART[APOLLO_High_Gain_S_band_Antenna]:FOR[RealismOverhaulRT]:NEEDS[RemoteTech]
{
    @description ^= :$: Maximum effective range approximately 600 Gm, power consumption 20 Watts, data rate 2 Mbit/s.

    !MODULE[ModuleDeployableAntenna],*{}

    !MODULE[ModuleDataTransmitter],*{}

    !MODULE[ModuleAnimateGeneric],*{}

    !MODULE[ModuleSPU*],*{}

    !MODULE[ModuleRTAntenna*],*{}

    MODULE
    {
        name = ModuleAnimateGeneric
        animationName = 1
        isOneShot = False
        startEventGUIName = Extend HGA
        endEventGUIName = Retract HGA
        actionGUIName = Toggle HGA
        actionAvailable = False
        eventAvailableEditor = False
        eventAvailableFlight = False
        eventAvailableEVA = False
        disableAfterPlaying = False
        allowManualControl = False
        allowAnimationWhileShielded = False
    }

    MODULE
    {
        name = ModuleSPUPassive
    }

    //  Parabolic S-band antenna for deep space communications (medium beamwidth mode).
    //  Two redundant TWTAs for driving the HGA antenna (same as the CM antennae).

    MODULE
    {
        name = ModuleRTAntenna
        ActionMode0Name = Deactivate HGA
        ActionMode1Name = Activate HGA
        IsRTActive = False
        Mode0DishRange = 0
        Mode1DishRange = 600000
        DishAngle = 11.0
        EnergyCost = 0.02
        DeployFxModules = 0

        TRANSMITTER
        {
            PacketInterval = 1.0
            PacketSize = 2.048
            PacketResourceCost = 0.02
        }
    }
}
//  ==================================================
//  Apollo High Gain Antenna (HGA).

//  Real Antennas compatibility.
//  ==================================================
@PART[APOLLO_High_Gain_S_band_Antenna]:BEFORE[RealAntennas]:NEEDS[RealAntennas]
{
	!MODULE[ModuleDataTransmitter],* {}
	MODULE
	{
		name = ModuleRealAntenna
		antennaDiameter = 1.8	//Antenna diameter based on combined area of 4 dishes
		RFBand = S	//Default to S-band
	}
	MODULE
	{
		name = ModuleRealAntenna
		referenceGain = 3.0		//Omni based on steerable antenna in low gain mode
		RFBand = S		//Default to S-band
	}
}

//  ==================================================
//  Apollo Particles and Fields Subsatellite (PFS).

//  Dimensions: 0.36 m x 0.78 m
//  Gross Mass: 38 kg
//  ==================================================

@PART[APOLLO_SubSat]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    //  Main subsatellite model.

    @MODEL
    {
        %scale = 1.0, 1.0, 1.0
        @rotation = 0.0, 180, 0.0
    }

    //  Solar array models, one for each side of the subsatellite.

    //  Top (+Z).

    MODEL
    {
        model = Squad/Parts/Electrical/radialFlatSolarPanel/model
        scale = 0.15, 0.15, 0.15
        position = 0.0, 0.044, 0.0
        rotation = -90.0, -30.0, 0.0
    }

    //  Bottom (-Z).

    MODEL
    {
        model = Squad/Parts/Electrical/radialFlatSolarPanel/model
        scale = 0.15, 0.15, 0.15
        position = 0.0, -0.044, 0.0
        rotation = 90.0, -30.0, 0.0
    }

    //  Left (+Y +Z).

    MODEL
    {
        model = Squad/Parts/Electrical/radialFlatSolarPanel/model
        scale = 0.15, 0.15, 0.15
        position = -0.0415, 0.024, 0.0
        rotation = -30.0, -120.0, 90.0
    }

    //  Left (+Y -Z).

    MODEL
    {
        model = Squad/Parts/Electrical/radialFlatSolarPanel/model
        scale = 0.15, 0.15, 0.15
        position = -0.0415, -0.024, 0.0
        rotation = 30.0, -120.0, 90.0
    }

    //  Right (-Y -Z).

    MODEL
    {
        model = Squad/Parts/Electrical/radialFlatSolarPanel/model
        scale = 0.15, 0.15, 0.15
        position = 0.0415, 0.024, 0.0
        rotation = -30.0, 60.0, 90.0
    }

    //  Right (-Y +Z).

    MODEL
    {
        model = Squad/Parts/Electrical/radialFlatSolarPanel/model
        scale = 0.15, 0.15, 0.15
        position = 0.0415, -0.024, 0.0
        rotation = 30.0, 60.0, 90.0
    }

    %scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_bottom = 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 0

    @title = Apollo Particles and Fields Subsatellite
    @manufacturer = TRW
    @description = The Apollo Particles and Fields Subsatellite (PFS) is a small scientific probe carrying a charged particle detector and a set of magnetometers for measuring the magnetic fields and density of solar particles in the vicinity of the Moon. It is deployed by the Apollo CSM after attaining a stable lunar orbit.

    @mass = 0.038
    @crashTolerance = 8
    @breakingForce = 250
    @breakingTorque = 250
    !linearStrength = NULL
    !angularStrength = NULL
    @maxTemp = 673.15
    %skinMaxTemp = 773.15
    !stageAfter = NULL
    !stageBefore = NULL
    @fuelCrossFeed = False
    %bulkheadProfiles = size0

    @MODULE[ModuleCommand]
    {
        @hasHibernation = False

        @RESOURCE[ElectricCharge]
        {
            @rate = 0.005
        }
    }

    @MODULE[ModuleSAS]
    {
        @SASServiceLevel = 0
    }

    !MODULE[ModuleReactionWheel],*{}

    @MODULE[ModuleDecouple]
    {
        @ejectionForce = 5
        %menuName = Eject Subsatellite
    }

    @MODULE[ModuleAnimateGeneric]
    {
        @startEventGUIName = Extend Magnetometers
        @endEventGUIName = Retract Magnetometers
        %actionGUIName = Toggle Magnetometers
    }

    !MODULE[ModuleDataTransmitter]:HAS[#antennaType[INTERNAL]],*{}

    @MODULE[ModuleDataTransmitter]:HAS[#antennaType[DIRECT]]
    {
        @antennaPower = 6400
        %antennaCombinable = True
        %antennaCombinableExponent = 2.0
        @packetInterval = 1.0
        @packetSize = 0.1
        @packetResourceCost = 0.005
    }

    !MODULE[ModuleDeployableSolarPanel],*{}

    //  Six body mounted solar arrays (18 V @ 0.25 A each, only three of them are sunlit at any given time.
    //  Using a spherical model since only a single solar array transform is counted as a valid.

    MODULE
    {
        name = ModuleDeployableSolarPanel
        pivotName = suncatcher
        secondaryTransformName = suncatcher
        panelType = SPHERICAL
        resourceName = ElectricCharge
        chargeRate = 0.048
        sunTracking = False
        retractable = False
        isTracking = False
        isBreakable = False
    }

    !MODULE[ModuleEngines*],*{}

    !RESOURCE,*{}

    //  One battery 85 Wh (17 V @ 5 Ah).

    RESOURCE
    {
        name = ElectricCharge
        amount = 306
        maxAmount = 306
    }
}

//  ==================================================
//  Apollo Particles and Fields Subsatellite (PFS).

//  Remote Tech compatibility.
//  ==================================================

@PART[APOLLO_SubSat]:FOR[RealismOverhaulRT]:NEEDS[RemoteTech]
{
    @description ^= :$: Integrated telecommunications system with a maximum effective range of 400 Mm, power consumption 2.5 Watts.

    !MODULE[ModuleDeployableAntenna],*{}

    !MODULE[ModuleDataTransmitter],*{}

    !MODULE[ModuleRTAntenna*],*{}

    !MODULE[ModuleSPU*],*{}

    MODULE
    {
        name = ModuleSPU
        IsRTCommandStation = False
        RTCommandMinCrew = 0
    }

    MODULE
    {
        name = ModuleRTAntenna
        ActionMode0Name = Deactivate Antenna
        ActionMode1Name = Activate Antenna
        IsRTActive = False
        Mode0OmniRange = 0
        Mode1OmniRange = 4000000
        EnergyCost = 0.0025
        DeployFxModules = 0
        ProgressFxModules = 1

        TRANSMITTER
        {
            PacketInterval = 1.0
            PacketSize = 0.128
            PacketResourceCost = 0.0025
        }
    }
}

//  ==================================================
//  AJ10-137 (Apollo SPS) engine.

//  Dimensions: 2.51 m x 3.33 m
//  Gross Mass: 295 kg
//  ==================================================

@PART[APOLLO_ENGINE]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    !mesh = NULL

    @MODEL
    {
        %scale = 1.0, 1.0, 1.0
    }

    %scale = 1.0
    @rescaleFactor = 1.0

    @node_stack_top = 0.0, 0.375, 0.0, 0.0, 1.0, 0.0, 3
    %node_stack_bottom = 0.0, -2.57, 0.0, 0.0, -1.0, 0.0, 3

    @mass = 0.295
    @crashTolerance = 10
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 673.15
    %skinMaxTemp = 773.15
    %fuelCrossFeed = True
    %stageOffset = 1
    %childStageOffset = 1
    !stageAfter = NULL
    !stageBefore = NULL
    %stagingIcon = LIQUID_ENGINE
    %bulkheadProfiles = srf, size3

    %engineType = AJ10_137

    @MODULE[ModuleEngines*]
    {
        PROPELLANT
        {
            name = Aerozine50
            ratio = 0.5017
            DrawGauge = True
        }

        @PROPELLANT[MonoPropellant]
        {
            @name = NTO
            @ratio = 0.4983
            @DrawGauge = False
            !resourceFlowMode = NULL
        }

        @atmosphereCurve
        {
            @key,0 = 0 314
            @key,1 = 1 190
        }
    }
}
