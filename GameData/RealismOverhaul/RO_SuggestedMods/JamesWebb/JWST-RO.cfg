//Sources:
//https://jwst.nasa.gov/content/about/faqs/facts.html

//https://twitter.com/StephenClark1/status/1473999069706129419

//https://twitter.com/cathirame/status/1463822922775097349?s=20&t=_oHLYCN9XbYFLuYMTAXaCg

//https://spaceflightnow.com/2021/11/28/nasa-gives-green-light-to-fuel-james-webb-space-telescope/

//https://jwst-docs.stsci.edu/jwst-observatory-hardware/jwst-spacecraft-bus/jwst-propulsion

// rescaleFactor = 5.4m (fairing) / 3.75m (size) = 1.44
// Total power in JWST is 2kW. Added 1 kW as extra for solar panels.

@PART[JWST*]:FOR[RealismOverhaul] //FIXME: Is this wildcard safe enough?
{
    %RSSROConfig = True
    @rescaleFactor = 1.44
}

@PART[JWST-BaseStructure]:FOR[RealismOverhaul]
{
    //FIXME: mass is ignored since the engine module overrides the mass. Should there just be a note here about that?
    @mass = 5.7534 //6.1614t Total - 0.1675t Hydrazine - 0.1325t NTO - 0.005t Main Antenna - - 8 x 0.001t RCS Thrusters - 0.025t Rear Solar Panel - 0.005t Side Antenna - 4 x 0.005t Side Solar Panels

    !RESOURCE,* {}
    MODULE
    {
        name = ModuleFuelTanks
        type = ServiceModule
        volume = 241.1
        basemass = -1

        TANK
        {
            name = ElectricCharge
            amount = 6840 //FIXME 1.9 kWh, is it 2x?
            maxAmount = 6840
        }
        TANK
        {
            name = Hydrazine
            amount = 159
            maxAmount = 159
        }
        TANK
        {
            name = NTO
            amount = 79.5
            maxAmount = 79.5
        }
        TANK
        {
            name = Helium
            amount = 66000 //FIXME not calculated
            maxAmount = 66000
        }
    }

    @MODULE[ModuleReactionWheel] //FIXME Use reaction wheel configtool?
    {
        //decreased by 3 times as 15 is too overpowered
        @PitchTorque = 5
        @YawTorque = 5
        @RollTorque = 5
        @RESOURCE[ElectricCharge]
        {
            @rate = 1
        }
    }

    MODULE
    {
        name = ModuleEngineConfigs
        type = ModuleEnginesFX
        origMass = 5.7534
        configuration = SCAT

        CONFIG
        {
            name = TR-500 Secondary Combustion Augmented Thruster
            minThrust = 0.0178 //4lbf, 30% thrust modulation
            maxThrust = 0.0623 //14lbf

            //O/F = 1.3 (actually 0.95 - 1.6)
            PROPELLANT
            {
                name = Hydrazine
                ratio = 0.5304
                DrawGauge = True
            }
            PROPELLANT
            {
                name = NTO
                ratio = 0.4696
            }
            PROPELLANT
            {
                name = Helium
                ratio = 10.5
            }
            atmosphereCurve
            {
                key = 0 295
                key = 1 210 //guess
            }

            ullage = False
            pressureFed = True
            ignitions = 0 //FIXME Is it unlimited?
            IGNITOR_RESOURCE
            {
                name = ElectricCharge
                amount = 0.05
            }
        }
    }
}

@PART[JWST-MainAntenna]:FOR[RealismOverhaul]
{
    !MODULE[ModuleDataTransmitter],* {}
    MODULE
    {
        name = ModuleRealAntenna
        referenceGain = 2.0 //guess
        RFBand = Ka
    }
}

@PART[JWST-SideAntenna]:FOR[RealismOverhaul]
{
    !MODULE[ModuleDataTransmitter],* {}
    MODULE
    {
        name = ModuleRealAntenna
        referenceGain = 1.0 //guess
        RFBand = S
    }
}

@PART[JWST-RCSThrusters]:FOR[RealismOverhaul]
{
    @mass = 0.001 //1kg DTM thrusters
    @MODULE[ModuleRCSFX],*
    {
        @thrusterPower = 0.089 //2 x 1lbf
        !resourceName = NULL

        PROPELLANT
        {
            name = Hydrazine
            ratio = 1.0
            DrawGauge = True
        }
    }
}

@PART[JWST-RearSolarPanel]:FOR[RealismOverhaul]
{
    @MODULE[ModuleDeployableSolarPanel] //FIXME Use solar tool?
    {
        @chargeRate = 2
    }
}

@PART[JWST-SideFlaps]:FOR[RealismOverhaul]
{
    @MODULE[ModuleDeployableSolarPanel] //FIXME Use solar tool?
    {
        @chargeRate = 0.25
    }
}