// Initialize optional keys that may be inserted by AutoConfig.

@PART[*]:HAS[@ROWaterfall]:FOR[zROWaterfall_18_LateInitialize]:NEEDS[Waterfall]
{
    @ROWaterfall
    {
        @ExtraTemplate,*
        {
            // Required key: `template`.
            &transform = #$../transform$
            &position = #$../position$
            &rotation = #$../rotation$
            &scale = #$../scale$
        }

        @MainPlumeVariant,*
        {
            // Required key: `name`.
            // Required key: `template`.
            &position = #$../position$
            &rotation = #$../rotation$
            &scale = #$../scale$
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#glow]]:FOR[zROWaterfall_18_LateInitialize]:NEEDS[Waterfall]
{
    @ROWaterfall
    {
        &glowStretch = 1

        @MainPlumeVariant,*
        {
            // Inherit from parent by default -- i.e., no recolor.
            &glowRecolor = #$../glow$
        }
    }
}

// Attempt to produce a legible default variant name if one is not set.
@PART[*]:HAS[@ROWaterfall:HAS[@MainPlumeVariant,~defaultMainPlumeVariantName]]:FOR[zROWaterfall_18_LateInitialize]:NEEDS[Waterfall]
{
    @ROWaterfall
    {
        defaultMainPlumeVariantName = #$template$
        @defaultMainPlumeVariantName ^= :^(ro)?waterfall-::
        @defaultMainPlumeVariantName ^= :^BDB_::
        @defaultMainPlumeVariantName ^= :-\d+::
        @defaultMainPlumeVariantName ^= :-lower::
        @defaultMainPlumeVariantName ^= :-upper::
        @defaultMainPlumeVariantName ^= :[-_]sustainer::
    }
}
